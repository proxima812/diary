---
import { navigation } from "@/data/data";
import NavList from "./NavList.astro";
import { Icon } from "astro-icon/components";
---

<nav class="hidden md:flex gap-5 items-center">
	<NavList
		navigation={navigation}
		className="flex items-center gap-1 text-[var(--text-main)] transition-colors"
	/>
</nav>

<button
	title="Мобильное меню"
	id="open"
	class="order-3 md:order-0 md:hidden flex h-[36px] w-[40px] items-center justify-center rounded-lg border border-[var(--border-soft)] bg-[var(--bg-elevated)] text-[var(--text-main)]"
	aria-controls="menu"
	aria-expanded="false"
>
	<Icon name="mdi:menu-open" class="text-xl" />
	<span class="sr-only">Мобильное меню</span>
</button>

<div
	id="menu"
	class="absolute left-0 top-[68px] z-50 hidden h-full w-full items-start justify-center bg-black/50 px-6 py-12 backdrop-blur md:-z-10 transition-all duration-300 ease-in-out"
	role="menu"
	aria-hidden="true"
>
	<nav class="flex w-full max-w-sm flex-col items-center gap-5 rounded-2xl border border-[var(--border-soft)] bg-[var(--bg-surface)] p-5">
		<NavList
			navigation={navigation}
			className="flex items-center gap-1 text-lg md:text-xl text-[var(--text-main)]"
		/>
	</nav>
</div>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const menu = document.querySelector("#menu");
		const menuBtn = document.querySelector("#open");
		const body = document.querySelector("body");
		const menunavigation = document.querySelectorAll("#menu a");
		const openClass = "hidden";

		menunavigation.forEach((link) => {
			link.addEventListener("click", () => {
				menu?.classList.add(openClass);
				body?.classList.remove("overflow-hidden");
				menuBtn?.setAttribute("aria-expanded", "false");
				menu?.setAttribute("aria-hidden", "true");
			});
		});

		menuBtn?.addEventListener("click", () => {
			const isHidden = menu?.classList.toggle(openClass);
			body?.classList.toggle("overflow-hidden");
			menuBtn?.setAttribute("aria-expanded", !isHidden);
			menu?.setAttribute("aria-hidden", isHidden);
		});
	});
</script>
