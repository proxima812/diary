<div
	id="pwa-install-banner"
	class="fixed bottom-4 left-1/2 z-50 hidden w-[min(92vw,560px)] -translate-x-1/2 rounded-2xl border border-[var(--border-soft)] bg-[var(--bg-elevated)] p-4 shadow-[0_16px_30px_-22px_rgba(0,0,0,0.55)]"
>
	<p class="text-sm font-medium text-[var(--text-main)]">Установить приложение на устройство?</p>
	<p class="mt-1 text-xs text-[var(--text-muted)]">
		Будет быстрее открываться и работать как отдельное приложение.
	</p>
	<div class="mt-3 flex items-center gap-2">
		<button
			id="pwa-install-button"
			type="button"
			class="rounded-lg bg-[var(--text-main)] px-3 py-1.5 text-sm font-medium text-[var(--bg-page)] transition-colors hover:opacity-90"
		>
			Установить
		</button>
		<button
			id="pwa-dismiss-button"
			type="button"
			class="rounded-lg border border-[var(--border-soft)] bg-[var(--bg-soft)] px-3 py-1.5 text-sm text-[var(--text-main)]"
		>
			Позже
		</button>
	</div>
</div>

<script>
	let installEvent = null;
	const DISMISSED_KEY = "pwa-install-banner-dismissed";

	const banner = document.getElementById("pwa-install-banner");
	const installBtn = document.getElementById("pwa-install-button");
	const dismissBtn = document.getElementById("pwa-dismiss-button");

	const hideBanner = () => banner?.classList.add("hidden");
	const showBanner = () => banner?.classList.remove("hidden");

	if (localStorage.getItem(DISMISSED_KEY) === "1") hideBanner();

	window.addEventListener("beforeinstallprompt", event => {
		event.preventDefault();
		installEvent = event;
		if (localStorage.getItem(DISMISSED_KEY) !== "1") showBanner();
	});

	window.addEventListener("appinstalled", () => {
		localStorage.setItem(DISMISSED_KEY, "1");
		hideBanner();
		installEvent = null;
	});

	dismissBtn?.addEventListener("click", () => {
		localStorage.setItem(DISMISSED_KEY, "1");
		hideBanner();
	});

	installBtn?.addEventListener("click", async () => {
		if (!installEvent) return;
		installEvent.prompt();
		await installEvent.userChoice;
	});
</script>
