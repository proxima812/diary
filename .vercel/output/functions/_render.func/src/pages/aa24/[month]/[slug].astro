---
import Copy from "@/components/Copy.astro"
import SavedPostButton from "@/components/SavedPostButton.tsx"
import { aa24hours } from "@/data/reflections/aa24hours"
import Layout from "@/layouts/Layout.astro"
import { marked } from "marked"

export const prerender = false

const { slug, month } = Astro.params

const monthPosts = aa24hours[month]
const entry = monthPosts?.[slug]
const dayKey = entry ? Object.keys(entry)[0] : null
const postData = dayKey ? entry[dayKey] : null

if (!postData) {
	return Astro.redirect("/404")
}
---

<Layout
	title={`Размышления Я и АА 24 часа - ${postData.title}`}
	description={"Размышления АА "}
	keywords="ежедневники анонимных сообществ, ежедневник аа, ежедневник ан, ал-анон ежедневник"
>
	<main class="flex flex-col gap-12 mx-auto max-w-4xl">
		<div class="flex items-center justify-between">
			<h3
				class="border-l-2 border-[var(--border-soft)] pl-3 text-base font-medium text-[var(--text-muted)] md:text-lg"
			>
				Я и АА 24 часа
			</h3>
			<div class="flex items-center gap-2">
				<SavedPostButton
					client:load
					id={`aa24-${month}-${slug}`}
					title={postData.title}
					desc={postData.desc}
				/>
				<Copy />
			</div>
		</div>

		<div
			class="-mx-2 rounded-2xl border border-[var(--border-soft)] bg-[var(--bg-surface)] md:mx-0"
		>
			<div class="rounded-2xl p-2">
				<div
					class="grid grid-cols-1 gap-6 rounded-xl border border-[var(--border-soft)] bg-[var(--bg-elevated)] p-6 md:p-10"
				>
					<div class="mb-8">
						<h1 class="mb-4 text-[var(--text-main)] text-3xl md:text-5xl font-bold">
							{postData.title}
						</h1>
						<p
							class="border-l-2 border-[var(--border-soft)] pl-3 text-[var(--text-muted)]"
						>
							<span id="postDesc">{postData.desc}</span>
						</p>
					</div>

					<article
						id="postContent"
						class="prose prose-lg max-w-none xl:prose-xl"
						set:html={marked(postData.content)}
					/>
				</div>
			</div>
		</div>
	</main></Layout
>
